---
title: "Lesson 3 - Additional Visualizations"
author: "Caitlin Eger"
date: "September 8, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Making pretty pictures

Because R is an open source software package, there are many different packages for generating graphs, maps, animations, etc.  We won't be able to introduce everything during this workshop, but we want to give you enough tools to get started.  Remember, a quick internet search usually turns up some helpful examples if you are struggling to get your plot to look right.

## Base R images

The functions included with your basic R install are actually super flexible.  It is possible to make a figure do pretty much anything using the base R plotting functions.  The downside of all this flexibility is you might need to do a lot of coding to get your plot perfect.

Lets look at some examples using some data from Lesson 1

### Boxplot

```{r}
FLP2018 <- readRDS("data/FLP2018.Rdata")

plot(FLP2018$Site, FLP2018$Temp, 
     xlab = "Site",
     ylab = "Temperature in degrees C")
```

That was pretty quick and painless!  It also only scratches the surface of what these plots can do, but it can take a lot of work to learn all the functions you need.

### Boxplot and Scatterplot

Another example:
```{r}
par(mfrow = c(1,2))

plot(FLP2018$Site, FLP2018$Temp, 
     xlab = "Site",
     ylab = "Temperature in degrees C")

plot(FLP2018$Depth, FLP2018$Temp, col = FLP2018$Date,
     xlab = "Depth",
     ylab = "Temperature in degrees C")
```

The second figure here is a depth profile, but it doesn't look like one. Let's change it so that depth is represented on the vertical axis

### Boxplot and Lineplot

```{r}
par(mfrow = c(1,2))

plot(FLP2018$Site, FLP2018$Temp, 
     xlab = "Site",
     ylab = "Temperature in degrees C")

plot(y=FLP2018$Depth, x=FLP2018$Temp, col = FLP2018$Date,
<<<<<<< HEAD
     ylab = "Depth",
     xlab = "Temperature in degrees C",
     ylim=rev(range(FLP2018$Depth)))
```

Also notice the order in which you run lines of code is important, especially when creating graphics. Writing code is like writing a recipe, if we run lines of code in the wrong order, it can be like telling the computer to bake the cake before the batter is mixed. If we want to put a line, or additional points on the plot, we need to make sure everything happens in the right order.

## Introducing `ggplot`

### Scatterplot

The `ggplot` library provides more tools for creating data-driven visualizations. Let's create a scatterplot that shows the concentration of Green Algae in the fluoroprobe samples by depth and site.

```{r, results = FALSE}
library(ggplot2)
ggplot(data = FLP2018, aes(x = GreenAlgae, y = Depth, color = Site)) +
  geom_point(alpha = 0.5) + 
  scale_y_reverse( lim=c(11, 0)) +
  theme(legend.position = "none") +
  theme_bw()
```

### Boxplot

Let's make a boxplot of the Diatom concentrations in the fluoroprobe dataset by site, with jittered points that show the

```{r}
ggplot(data = FLP2018, aes(x = Site, y =  Diatoms, color = Site))+
  geom_boxplot(outlier.shape = NA) +
  ylab("Diatoms in ug/L")+
  geom_jitter(alpha = 0.25) +
  theme(legend.position = "none") + scale_color_viridis_d()
```

### Timeseries

```{r}
ggplot(data = FLP2018, 
       aes(x = Date, 
           y = Diatoms, 
           color = Site,
           group = Depth)) +
    geom_point(alpha = 0.25)


```
    
### Faceting

```{r}
ggplot(data = FLP2018, 
       aes(x = Date, 
           y = Diatoms, 
           color = Site,
           group = Depth)) +
    geom_point(alpha = 0.25) +
    facet_wrap( ~Site)
```

```{r}
ggplot(data = FLP2018, aes(x = GreenAlgae, y = Depth, color = Site)) +
  geom_point(alpha = 0.5) + 
  scale_y_reverse( lim=c(11, 0)) +
  theme(legend.position = "none") +
  theme_bw() +
    facet_wrap( ~Site)
```

## Introducing gganimate
```{r}
#install.packages("gganimate")
library(gganimate)
=======
    ylim=rev(range(FLP2018$Depth)), 
    axes = F, ann = F)
box()
axis(side = 3)
axis(side = 2)
mtext('Temperature (\u00B0C)', side = 3, line = 2.5)
mtext('Depth (m)', side = 2, line = 2.5)
```

Now it looks like a depth profile, but we had to do a lot of additional coding to get it this way.  Also, if you look at the dataset, the depth profile doesn't distinguish between sites - just dates!  Fixing this to look at each site will require creating a separate plot for each

Also notice the order in which you run lines of code is important when using the basic R graphics.  If we want to put a line, or additional points on the plot, we need to make sure everything happens in the right order.

### ggplot

This software package takes the control of basic R graphics and places them in a slightly more user friendly package.  This is still a fairly flexible package, but you do sacrafice some control for convenience.  We believe this package is very useful, especially for people just starting with R. 

Lets see if we can recreate plots from above:

```{r}
library(tidyverse) # or library(ggplot2)
library(gridExtra)

p1 <- ggplot(FLP2018, aes(x=Site, y=Temp))+
  geom_boxplot()+
  theme_bw()

p2 <- FLP2018 %>% ggplot(aes(x=Depth, y=Temp, color = factor(month(Date)), group = Date))+
  geom_path()+
  scale_x_reverse()+
  coord_flip()+
  scale_y_continuous(position = 'right')+
  facet_wrap(~Site, ncol = 1)+
  theme_bw()
```

Now we have recreated both of these plots.  We could visualize them at the same time, but I don't think that is actually necessary with this example.

```{r}
gridExtra::grid.arrange(p1, p2, nrow=1)
```

We can also fairly easily do a bunch of different things with our plots.  For example, if we wanted to visualize all the datapoints on top of the boxplot

```{r}
ggplot(data = FLP2018, aes(x = Site, y =  Temp, color = Site))+
  geom_boxplot(outlier.shape = NA) +
  ylab("Temperature in /00B0C")+
  geom_jitter(alpha = 0.25) +
  theme(legend.position = "none")+ 
  scale_color_viridis_d()
```

or a different example

```{r}
ggplot(data = FLP2018, aes(x = Site, y =  Diatoms, color = Site))+
  geom_boxplot(outlier.shape = NA) +
  ylab("Diatoms in ug/L")+
  geom_jitter(alpha = 0.25) +
  theme(legend.position = "none")+ scale_color_viridis_d()
```


```{r}
# install.packages("leaflet")
library(leaflet)
leaflet(data = na.omit(Hg$)) %>%
  leaflet::addTiles() %>%
  leaflet::addCircles(~lon, ~lat, opacity = 0.5)
leaflet(data = Hg$General_Location) %>%
  addTiles() %>%
  addCircles()
```

>>>>>>> d16d106e21692b3b007deb37d7aa1f22b60a911d
